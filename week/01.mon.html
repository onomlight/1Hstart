<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>월요일 일정</title>
    <link rel="icon" href="favicon.ico" />
  </head>
  <body>
    <button onclick="checkPassword()">수정하기</button>
    <button onclick="saveChanges()" style="display: none">저장하기</button>
    <table border="1" contenteditable="false">
      <tr>
        <td>*1:10</td>
        <td>
          채은, 대주, 대양, 아인, 예원, 이수, 소율, 나엘, 보경, 지아, 다인,
          제인, 수아
        </td>
      </tr>
      <tr>
        <td>1:45</td>
        <td>시율, 지우, 김준우, 허준우</td>
      </tr>
      <tr>
        <td>2:00</td>
        <td>서연, 주안</td>
      </tr>
      <tr>
        <td>2:10</td>
        <td>->이수, 제인, 나엘, 수아</td>
      </tr>
      <tr>
        <td>2:35</td>
        <td>(칠초 돌봄) 서영채, 민, 시현, 시온</td>
      </tr>
      <tr>
        <td>2:45</td>
        <td>-> 준우, 지우</td>
      </tr>
      <tr>
        <td>3:30</td>
        <td>(교동돌봄) 박채은, 김시율</td>
      </tr>
      <tr>
        <td>3:35</td>
        <td>칠초 서영채</td>
      </tr>
      <tr>
        <td>3:40</td>
        <td>(새솔) 하윤, 한솔, 윤이나</td>
      </tr>
      <tr>
        <td>3:45</td>
        <td>->영채, 시온, 민</td>
      </tr>
      <tr>
        <td>4:00</td>
        <td>(칠초돌봄)김찬호</td>
      </tr>
    </table>
    <script>
      const githubToken =
        "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";
      const repoOwner = "onomlight";
      const repoName = "1Hstart";
      const filePath = "week/01.mon.html";

      function checkPassword() {
        const password = prompt("암호를 입력하세요:");
        if (password === "1234") {
          document.querySelector("table").contentEditable = true;
          document.querySelector(
            "button[onclick='saveChanges()']"
          ).style.display = "inline";
        } else {
          alert("암호가 틀렸습니다.");
        }
      }

      // async function saveChanges() {
      //   const content = document.documentElement.outerHTML;
      //   const encodedContent = btoa(unescape(encodeURIComponent(content)));

      //   const url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`;
      //   const response = await fetch(url, {
      //     headers: { Authorization: `token ${githubToken}` },
      //   });
      //   const fileData = await response.json();

      //   const commitData = {
      //     message: "자동 업데이트: 01.mon.html",
      //     content: encodedContent,
      //     sha: fileData.sha,
      //   };

      //   await fetch(url, {
      //     method: "PUT",
      //     headers: {
      //       Authorization: `token ${githubToken}`,
      //       "Content-Type": "application/json",
      //     },
      //     body: JSON.stringify(commitData),
      //   });

      //   alert("수정된 내용이 GitHub에 업로드되었습니다!");
      //   location.reload();
      // }
      async function saveChanges() {
        const content = document.documentElement.outerHTML;
        const encodedContent = btoa(unescape(encodeURIComponent(content)));

        const url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`;
        const response = await fetch(url, {
          headers: { Authorization: `token ${githubToken}` },
        });

        if (!response.ok) {
          alert("GitHub에서 파일 정보를 가져오는 데 실패했습니다.");
          return;
        }

        const fileData = await response.json();
        const commitData = {
          message: "자동 업데이트: 01.mon.html",
          content: encodedContent,
          sha: fileData.sha,
        };

        const updateResponse = await fetch(url, {
          method: "PUT",
          headers: {
            Authorization: `token ${githubToken}`,
            "Content-Type": "application/json",
          },
          body: JSON.stringify(commitData),
        });

        const responseJson = await updateResponse.json();
        console.log(responseJson); // 응답 내용을 콘솔에 출력해 문제를 파악

        if (updateResponse.ok) {
          alert("수정된 내용이 GitHub에 업로드되었습니다!");
          location.reload();
        } else {
          alert("업로드 실패! API 응답 확인 필요");
        }
      }
    </script>
    <style>
      * {
        font-size: 1.35rem;
      }
      table {
        border-collapse: collapse;
      }
    </style>
  </body>
</html>
