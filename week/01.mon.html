<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>월요일 일정</title>
  </head>
  <body>
    <button onclick="checkPassword()">수정하기</button>
    <button onclick="saveChanges()" style="display: none">저장하기</button>
    <table border="1" contenteditable="false">
      <tr>
        <td>*1:10</td>
        <td>
          채은, 대주, 대양, 아인, 예원, 이수, 소율, 나엘, 보경, 지아, 다인,
          제인, 수아
        </td>
      </tr>
      <tr>
        <td>1:45</td>
        <td>시율, 지우, 김준우, 허준우</td>
      </tr>
      <tr>
        <td>2:00</td>
        <td>서연, 주안</td>
      </tr>
      <tr>
        <td>2:10</td>
        <td>->이수, 제인, 나엘, 수아</td>
      </tr>
      <tr>
        <td>2:35</td>
        <td>(칠초 돌봄) 서영채, 민, 시현, 시온</td>
      </tr>
      <tr>
        <td>2:45</td>
        <td>-> 준우, 지우</td>
      </tr>
      <tr>
        <td>3:30</td>
        <td>(교동돌봄) 박채은, 김시율</td>
      </tr>
      <tr>
        <td>3:35</td>
        <td>칠초 서영채</td>
      </tr>
      <tr>
        <td>3:40</td>
        <td>(새솔) 하윤, 한솔, 윤이나</td>
      </tr>
      <tr>
        <td>3:45</td>
        <td>->영채, 시온, 민</td>
      </tr>
      <tr>
        <td>4:00</td>
        <td>(칠초돌봄)김찬호</td>
      </tr>
    </table>
    <script>
      const githubToken = "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"; // 실제 GitHub 토큰을 여기에 입력하세요.
      const repoOwner = "onomlight";
      const repoName = "1Hstart";
      const filePath = "week/01.mon.html";

      // 비밀번호 입력 후 수정 가능하게 하는 함수
      function checkPassword() {
        const password = prompt("암호를 입력하세요:");
        if (password === "1234") {
          document.querySelector("table").contentEditable = true;
          document.querySelector(
            "button[onclick='saveChanges()']"
          ).style.display = "inline";
        } else {
          alert("암호가 틀렸습니다.");
        }
      }

      // 변경 사항을 GitHub에 저장하는 함수
      async function saveChanges() {
        const content = document.documentElement.outerHTML; // 페이지 전체 HTML 내용 가져오기
        const encodedContent = btoa(unescape(encodeURIComponent(content))); // 내용 인코딩

        const url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`;
        console.log("GitHub Token:", githubToken);
        try {
          // 파일 정보를 가져오기 위한 API 요청
          const response = await fetch(url, {
            headers: { Authorization: `token ${githubToken}` },
          });

          if (!response.ok) {
            alert("GitHub에서 파일 정보를 가져오는 데 실패했습니다.");
            return;
          }

          const fileData = await response.json();

          // 커밋 메시지 및 업데이트할 파일 데이터 준비
          const commitData = {
            message: "자동 업데이트: 01.mon.html",
            content: encodedContent,
            sha: fileData.sha, // 기존 파일의 SHA 값을 포함해야 함
          };

          // 파일 업데이트 요청
          const updateResponse = await fetch(url, {
            method: "PUT",
            headers: {
              Authorization: `token ${githubToken}`,
              "Content-Type": "application/json",
            },
            body: JSON.stringify(commitData),
          });

          const responseJson = await updateResponse.json();
          console.log(responseJson); // API 응답 확인

          if (updateResponse.ok) {
            alert("수정된 내용이 GitHub에 업로드되었습니다!");
            location.reload(); // 페이지 새로 고침
          } else {
            alert("업로드 실패! API 응답 확인 필요");
          }
        } catch (error) {
          console.error("업데이트 중 오류 발생:", error);
          alert("GitHub에 업데이트하는 중 오류가 발생했습니다.");
        }
      }
    </script>
    <style>
      * {
        font-size: 1.35rem;
      }
      table {
        border-collapse: collapse;
      }
    </style>
  </body>
</html>
